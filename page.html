<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>PÃ¡gina PÃºblica</title>
  <link rel="stylesheet" href="style.css?v=2">
  <style>
    body{display:flex;justify-content:center;align-items:flex-start;padding:24px}
    .pub-container{width:420px}
    .notfound{color:#ffb4b4;border:1px solid #552c2c;background:#2a1414;padding:12px;border-radius:10px}
    .pub-header{margin-bottom:12px}
  </style>
</head>
<body>
  <div class="pub-container">
    <div id="warn" class="notfound" style="display:none"></div>
    <div class="phone">
      <div id="pubHeader" class="phone-header">
        <div class="avatar">+</div>
        <div class="texts">
          <div id="pubTitle" class="pv-title">TÃ­tulo</div>
          <div id="pubSubtitle" class="pv-subtitle">SubtÃ­tulo</div>
        </div>
      </div>
      <div id="pubButtons" class="phone-body"></div>
    </div>
  </div>

  <script>
    (function(){
      const slug = location.hash.replace('#','').trim();
      const warn = document.getElementById('warn');
      if(!slug){
        warn.style.display='block';
        warn.textContent = 'Link invÃ¡lido. Falta o slug na URL (#slug).';
        return;
      }
      const KEY = 'anoig-public-' + slug;
      const raw = localStorage.getItem(KEY);
      if(!raw){
        warn.style.display='block';
        warn.textContent = 'PÃ¡gina nÃ£o encontrada neste navegador. (No MVP real, os dados vÃªm do servidor.)';
        return;
      }
      try{
        const data = JSON.parse(raw);
        // header
        document.getElementById('pubTitle').textContent = data.header?.title || 'TÃ­tulo';
        document.getElementById('pubSubtitle').textContent = data.header?.subtitle || '';
        const header = document.getElementById('pubHeader');
        const h = data.header || {};
        const preset = h.preset || 'pattern1';
        const bgType = h.bgType || (['pattern1','pattern2','pattern3'].includes(preset) ? 'preset' : preset);
        if(bgType === 'solid'){
          header.style.background = h.color || '#1f2937';
        } else if(bgType === 'gradient'){
          const g1 = h.grad1 || '#6366f1';
          const g2 = h.grad2 || '#ec4899';
          header.style.background =  `linear-gradient(135deg, ${g1}, ${g2})`; 
        } else {
          if(preset === 'pattern2'){
            header.style.background = 'linear-gradient(135deg,#283552,#1b2740)';
          } else if(preset === 'pattern3'){
            header.style.background = 'linear-gradient(135deg,#fef3c7,#fca5a5)';
          } else {
            header.style.background = 'linear-gradient(135deg,#1f2937,#111827)';
          }
        }
        // buttons
        const wrap = document.getElementById('pubButtons');
        wrap.innerHTML = '';
        (data.buttons||[]).forEach(b=>{
          const a = document.createElement('a');
          a.className = 'card-btn';
          a.target = '_blank';
          a.rel = 'noopener';
          a.href = b.link || '#';
          a.innerHTML = `
            <div class="card-inner">
              <div class="card-icon" style="background:${b.color || '#2b7a78'}"></div>
              <div class="card-label">${b.label || 'BotÃ£o'}</div>
            </div>`;
          wrap.appendChild(a);
        });
      }catch(e){
        warn.style.display='block';
        warn.textContent = 'Erro ao carregar dados.';
      }
    })();
  </script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    (async function(){
      const slug = location.hash.replace('#','').trim();
      const warn = document.getElementById('warn');
      if(!slug) return;
      const SUPABASE_URL = "https://tyhoonmssqxbtktiuwtd.supabase.co";
      const SUPABASE_ANON = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR5aG9vbm1zc3F4YnRrdGl1d3RkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc0Mjg5MTgsImV4cCI6MjA3MzAwNDkxOH0.e-vVW5CSihmFlYGpvms0KLCrhqxdCqujJxhT6a-nBpI";
      if(typeof supabase === 'undefined') return;
      try{
        const supa = supabase.createClient(SUPABASE_URL, SUPABASE_ANON);
        const { data: pg, error: e1 } = await supa
          .from('pages')
          .select('id, title, subtitle, header_preset, header_color, is_published')
          .eq('slug', slug)
          .eq('is_published', true)
          .single();
        if(e1 || !pg) return;
        const { data: btns } = await supa
          .from('buttons')
          .select('label, url, order_index, color, text_color, size, radius, shadow')
          .eq('page_id', pg.id)
          .order('order_index', { ascending:true });

        // Atualiza DOM
        document.getElementById('pubTitle').textContent = pg.title || 'Título';
        document.getElementById('pubSubtitle').textContent = pg.subtitle || '';
        if(warn){ warn.style.display='none'; warn.textContent=''; }
        const header = document.getElementById('pubHeader');
        const preset = pg.header_preset || 'pattern1';
        if(preset === 'solid'){
          header.style.background = pg.header_color || '#1f2937';
        } else if(preset === 'gradient'){
          let [g1,g2] = (pg.header_color || '').split('|');
          header.style.background = `linear-gradient(135deg, ${g1||'#6366f1'}, ${g2||'#ec4899'})`;
        } else {
          if(preset === 'pattern2') header.style.background = 'linear-gradient(135deg,#283552,#1b2740)';
          else if(preset === 'pattern3') header.style.background = 'linear-gradient(135deg,#fef3c7,#fca5a5)';
          else header.style.background = 'linear-gradient(135deg,#1f2937,#111827)';
        }

        const wrap = document.getElementById('pubButtons');
        wrap.innerHTML='';
        (btns||[]).forEach(b=>{
          const a=document.createElement('a');
          a.className='card-btn'; a.target='_blank'; a.rel='noopener'; a.href=b.url||'#';
          a.style.borderRadius=(typeof b.radius==='number'?b.radius:14)+'px';
          a.setAttribute('data-size', b.size||'md');
          a.setAttribute('data-shadow', b.shadow?'true':'false');
          a.style.background=b.color||'#2b7a78';
          a.innerHTML=`<div class="card-inner"><div class="card-icon" style="background:${b.color||'#2b7a78'}"></div><div class="card-label" style="color:${b.text_color||'#ffffff'}">${b.label||'Botão'}</div></div>`;
          wrap.appendChild(a);
        });
      }catch(e){ console.error(e); }
    })();
  </script>
</body>
</html>


